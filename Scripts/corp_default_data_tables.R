# File: corp_default_data_tables.R
# Author: Tyler Pike
# Date: 10/9/2019
# Note(s): Create summary statistics of explanetory variables.

# clear enviroment
rm(list=ls())

# libraries
library(policyPlot)
library(lubridate)
library(dplyr)
library(TTR)
library(moments)

#----------------------------------------------
# Explanetory Variables Descriptions
#----------------------------------------------
#not grouped 
data.mergent = readRDS("corp_default_data_ucla_nyu_mergent.RDS") %>%
               select(EXRET ,           # <dbl> 0.62406337, 1.19013721, 1.13304704, -0.44992436, 1.19718767, -0.45272043, 0.9...
                      EXRETAVG,         # <dbl> -0.67561669, -1.09325375, 0.46100561, 1.36719247, 0.32328424, 0.57380251, 0.1...
                      INDSALES ,       #  <dbl> -0.2508604, -0.2673129, -0.2674240, -0.2672032, -0.2358847, -0.2369259, -0.23...
                      INDSALESGR,      #  <dbl> 0.38973857, -0.24045397, -0.24054314, -0.24057832, 0.43085610, 0.43205433, 0....
                      AGE        ,      # <dbl> 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 1, 3, 3, 3, 3, 4, 4,...
                      NITA        ,    #  <dbl> 0.55776240, 0.14181591, 0.14181591, 0.14074747, 0.48555940, 0.48439572, 0.481...
                      TLTA         ,   #  <dbl> -0.15680428, -0.15918881, -0.15863723, -0.15801233, -0.24500201, -0.24392061,...
                      NIMTA       ,     # <dbl> 0.56318870, 0.13204334, 0.13204334, 0.13073781, 0.47650269, 0.47546215, 0.473...
                      TLMTA ,          #  <dbl> -0.36159103, -0.22598314, -0.22560329, -0.22462665, -0.49579739, -0.49546809,...
                      CASHMTA,         #  <dbl> 0.62639196, 0.07945028, 0.07928220, 0.07968876, 0.08680881, 0.08662378, 0.083...
                      PRICE   ,         # <dbl> -0.18517044, -0.29909382, -0.29959789, -0.30341802, -0.03471163, -0.03404721,...
                      MB       ,       #  <dbl> -0.10309835, -0.28716342, -0.28718733, -0.28743306, -0.06783022, -0.06532433,...
                      NIMTAAVG  ,      #  <dbl> 0.4344887, 0.5297841, 0.5294807, 0.5282360, 0.2930406, 0.2965624, 0.2951213, ...
                      Q          ,     #  <dbl> -0.15797193, -0.28498454, -0.28501444, -0.28504310, -0.09442898, -0.09486665,...
                      DIVDUMMY    ,    #  <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
                      KZ           ,   #  <dbl> -0.04847739, 0.05008293, 0.05101715, 0.05348882, 0.03435362, 0.03683820, 0.04...
                      HP    ,          #  <dbl> -0.53307787, -0.52817454, -0.52840938, -0.53028978, -0.52874738, -0.53015778,...
                      WW     ,         #  <dbl> -0.9040522, -0.8860785, -0.8858645, -0.8859861, -0.8889005, -0.8884091, -0.88...
                      Z       ,        #  <dbl> -0.2351307, -0.2642653, -0.2645353, -0.2655766, -0.2054104, -0.2057359, -0.20...
                      WCTA     ,       #  <dbl> -0.18993344, -0.76095717, -0.76123451, -0.77284771, -0.55895458, -0.55566607,...
                      CURRENTRATIO, #      <dbl> -0.4914688, -0.6605296, -0.6606678, -0.6610031, -0.5857869, -0.5852445, -0.58...
                      ASSETTURNOVER, #     <dbl> -0.3356886, -0.3250663, -0.3251159, -0.3256434, -0.3270087, -0.3268440, -0.32...
                      ROE     ,        #  <dbl> 0.34303640, 0.08446609, 0.08446609, 0.08692248, 0.29826732, 0.29721404, 0.300...
                      EBITCOVER,       #  <dbl> -0.2075381, -0.2278094, -0.2278637, -0.2281201, -0.1919369, -0.1908313, -0.19...
                      CAPEXTA)         # <dbl> 2.12710809, 3.13948744, 3.13906269, 3.13582515, -0.08598936, -0.08713054, -0....

descriptiveStats = psych::describe(data.mergent)
descriptiveStats = descriptiveStats %>% select(-vars, -n)
xtable::xtable(descriptiveStats)

#grouped by industry 
data.mergent = readRDS("corp_default_data_ucla_nyu_mergent.RDS") %>%
  select(EXRET ,           # <dbl> 0.62406337, 1.19013721, 1.13304704, -0.44992436, 1.19718767, -0.45272043, 0.9...
         EXRETAVG,         # <dbl> -0.67561669, -1.09325375, 0.46100561, 1.36719247, 0.32328424, 0.57380251, 0.1...
         INDSALES ,       #  <dbl> -0.2508604, -0.2673129, -0.2674240, -0.2672032, -0.2358847, -0.2369259, -0.23...
         INDSALESGR,      #  <dbl> 0.38973857, -0.24045397, -0.24054314, -0.24057832, 0.43085610, 0.43205433, 0....
         AGE        ,      # <dbl> 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 1, 3, 3, 3, 3, 4, 4,...
         NITA        ,    #  <dbl> 0.55776240, 0.14181591, 0.14181591, 0.14074747, 0.48555940, 0.48439572, 0.481...
         TLTA         ,   #  <dbl> -0.15680428, -0.15918881, -0.15863723, -0.15801233, -0.24500201, -0.24392061,...
         NIMTA       ,     # <dbl> 0.56318870, 0.13204334, 0.13204334, 0.13073781, 0.47650269, 0.47546215, 0.473...
         TLMTA ,          #  <dbl> -0.36159103, -0.22598314, -0.22560329, -0.22462665, -0.49579739, -0.49546809,...
         CASHMTA,         #  <dbl> 0.62639196, 0.07945028, 0.07928220, 0.07968876, 0.08680881, 0.08662378, 0.083...
         PRICE   ,         # <dbl> -0.18517044, -0.29909382, -0.29959789, -0.30341802, -0.03471163, -0.03404721,...
         MB       ,       #  <dbl> -0.10309835, -0.28716342, -0.28718733, -0.28743306, -0.06783022, -0.06532433,...
         NIMTAAVG  ,      #  <dbl> 0.4344887, 0.5297841, 0.5294807, 0.5282360, 0.2930406, 0.2965624, 0.2951213, ...
         Q          ,     #  <dbl> -0.15797193, -0.28498454, -0.28501444, -0.28504310, -0.09442898, -0.09486665,...
         DIVDUMMY    ,    #  <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
         KZ           ,   #  <dbl> -0.04847739, 0.05008293, 0.05101715, 0.05348882, 0.03435362, 0.03683820, 0.04...
         HP    ,          #  <dbl> -0.53307787, -0.52817454, -0.52840938, -0.53028978, -0.52874738, -0.53015778,...
         WW     ,         #  <dbl> -0.9040522, -0.8860785, -0.8858645, -0.8859861, -0.8889005, -0.8884091, -0.88...
         Z       ,        #  <dbl> -0.2351307, -0.2642653, -0.2645353, -0.2655766, -0.2054104, -0.2057359, -0.20...
         WCTA     ,       #  <dbl> -0.18993344, -0.76095717, -0.76123451, -0.77284771, -0.55895458, -0.55566607,...
         CURRENTRATIO, #      <dbl> -0.4914688, -0.6605296, -0.6606678, -0.6610031, -0.5857869, -0.5852445, -0.58...
         ASSETTURNOVER, #     <dbl> -0.3356886, -0.3250663, -0.3251159, -0.3256434, -0.3270087, -0.3268440, -0.32...
         ROE     ,        #  <dbl> 0.34303640, 0.08446609, 0.08446609, 0.08692248, 0.29826732, 0.29721404, 0.300...
         EBITCOVER,       #  <dbl> -0.2075381, -0.2278094, -0.2278637, -0.2281201, -0.1919369, -0.1908313, -0.19...
         CAPEXTA,
         SEC10, SEC15,
         SEC20, SEC25,
         SEC30, SEC35,
         SEC40, SEC45,
         SEC50, SEC55,
         SEC60) %>% 
         mutate(Industry = if_else(SEC10 == 1 | SEC15 == 1, 10, as.numeric(NA)),
                Industry = if_else(SEC20 == 1 | SEC25 == 1, 20, Industry),
                Industry = if_else(SEC30 == 1 | SEC35 == 1, 30, Industry),
                Industry = if_else(SEC40 == 1 | SEC45 == 1, 40, Industry),
                Industry = if_else(SEC50 == 1 | SEC55 == 1, 50, Industry),
                Industry = if_else(SEC60 == 1, 60, Industry)) %>% 
         select(-SEC10, -SEC15,
                -SEC20, -SEC25,
                -SEC30, -SEC35,
                -SEC40, -SEC45,
                -SEC50, -SEC55,
                -SEC60)


descriptiveStats = psych::describe.by(data.mergent,'Industry', range = T, skew= F)
xtable::xtable(descriptiveStats$`10`)
xtable::xtable(descriptiveStats$`20`)
xtable::xtable(descriptiveStats$`30`)
xtable::xtable(descriptiveStats$`40`)
xtable::xtable(descriptiveStats$`50`)
xtable::xtable(descriptiveStats$`60`)




